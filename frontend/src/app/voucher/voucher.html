<!-- Voucher/Reviews Page Content -->
<main class="min-h-screen bg-white py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Reviews & Vouches</h1>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="flex justify-center items-center py-12">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
            <span class="ml-3 text-gray-600">Loading vouches...</span>
        </div>

        <!-- Vouches List -->
        <div *ngIf="!isLoading && vouches.length > 0" class="space-y-6">
            <div *ngFor="let vouch of vouches" class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <div class="flex flex-col sm:flex-row items-start space-y-4 sm:space-y-0 sm:space-x-4">
                    <!-- Avatar and User Info -->
                    <div class="flex items-center space-x-3 sm:space-x-4">
                        <div class="flex-shrink-0">
                            <img [src]="getAvatarUrl(vouch.avatarSeed)" [alt]="vouch.username"
                                class="w-12 h-12 sm:w-16 sm:h-16 rounded-full object-cover" />
                        </div>
                        <div class="flex flex-col">
                            <div class="flex items-center space-x-2">
                                <h3 class="text-lg font-semibold text-gray-900">{{ vouch.username || 'Anonymous' }}</h3>
                                <span *ngIf="vouch.isVerified"
                                    class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">
                                    VERIFIED PURCHASE
                                </span>
                            </div>
                            <span class="text-sm text-gray-500">{{ formatDate(vouch.createdAt) }}</span>
                        </div>
                    </div>

                    <!-- Rating Stars -->
                    <div class="flex items-center space-x-1">
                        <div class="flex items-center space-x-1">
                            <i *ngFor="let star of getRatingStars(vouch.rating).filled; let i = index"
                                class="fas fa-star text-green-500 text-sm"></i>
                            <i *ngFor="let star of getRatingStars(vouch.rating).empty; let i = index"
                                class="far fa-star text-gray-300 text-sm"></i>
                        </div>
                    </div>
                </div>

                <!-- Review Content -->
                <div class="mt-4 flex flex-col lg:flex-row lg:items-start lg:space-x-6">
                    <!-- Review Text -->
                    <div class="flex-1">
                        <p class="text-gray-700 text-sm sm:text-base leading-relaxed">{{ vouch.reviewText }}</p>
                    </div>

                    <!-- Review Image (if available) -->
                    <div *ngIf="vouch.reviewImage" class="mt-4 lg:mt-0 lg:flex-shrink-0">
                        <img [src]="vouch.reviewImage" alt="Review image"
                            class="w-24 h-16 sm:w-32 sm:h-20 object-cover rounded-lg cursor-pointer hover:opacity-80 transition-opacity border border-gray-200"
                            (click)="showImage(vouch)" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && vouches.length === 0" class="text-center py-12">
            <div class="text-gray-500">
                <i class="fas fa-star text-4xl mb-4 text-gray-400"></i>
                <h3 class="mt-2 text-lg font-medium text-gray-900">No vouches yet</h3>
                <p class="mt-1 text-sm text-gray-500">Be the first to leave a review!</p>
            </div>
        </div>

        <!-- Pagination -->
        <div *ngIf="totalPages > 1" class="flex justify-center mt-8">
            <nav class="flex items-center space-x-1">
                <!-- Previous Button -->
                <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1"
                    class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                    Previous
                </button>

                <!-- Page Numbers -->
                <ng-container *ngFor="let page of getPageNumbers()">
                    <button (click)="onPageChange(page)"
                        [class]="page === currentPage 
              ? 'px-3 py-2 text-sm font-medium text-white bg-blue-600 border border-blue-600 rounded-md' 
              : 'px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50'">
                        {{ page }}
                    </button>
                </ng-container>

                <!-- Next Button -->
                <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages"
                    class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                    Next
                </button>
            </nav>
        </div>
    </div>

    <!-- Image Modal -->
    <div *ngIf="showImageModal && selectedVouch"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
        (click)="closeImageModal()">
        <div class="bg-white rounded-lg max-w-2xl max-h-full overflow-auto" (click)="$event.stopPropagation()">
            <div class="p-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">{{ selectedVouch.username }}'s Review</h3>
                    <button (click)="closeImageModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <img [src]="selectedVouch.reviewImage" alt="Review image" class="w-full h-auto rounded-lg" />
            </div>
        </div>
    </div>
</main>